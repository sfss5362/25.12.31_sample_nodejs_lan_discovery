# HTTP åŒå‘å“åº”æµ‹è¯•æŒ‡å—

## æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: æ­£å¸¸ HTTP å“åº”ï¼ˆæ¨èï¼‰

**æ­¥éª¤**:
1. æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯
2. ç»ˆç«¯ 1: `node index.js`
3. ç»ˆç«¯ 2: `node index.js`

**é¢„æœŸç»“æœ**:

**ç»ˆç«¯ 1 è¾“å‡º**:
```
=== LocalSend-like Discovery Started ===
UDP listening on 0.0.0.0:53317
...

[NEW DEVICE] GS-10-155-20230921 (192.168.1.100)
  Type: desktop, Model: linux-x64

--- Discovered Devices ---
1. GS-10-155-20230921 (desktop)
   IP: 192.168.1.100 | URL: http://192.168.1.100:53318
--------------------------
```

**ç»ˆç«¯ 2 è¾“å‡º**:
```
=== LocalSend-like Discovery Started ===
UDP listening on 0.0.0.0:53317
...

[HTTP RESPOND] GS-10-155-20230921 (127.0.0.1)
[NEW DEVICE] GS-10-155-20230921 (127.0.0.1)
  Type: desktop, Model: linux-x64

--- Discovered Devices ---
1. GS-10-155-20230921 (desktop)
   IP: 127.0.0.1 | URL: http://127.0.0.1:53317
--------------------------
```

**éªŒè¯ç‚¹**:
- âœ… çœ‹åˆ° `[HTTP RESPOND]` è¡¨ç¤ºä½¿ç”¨äº† HTTP å“åº”
- âœ… ä¸¤ä¸ªè®¾å¤‡äº’ç›¸å‘ç°
- âœ… å»¶è¿Ÿ < 2 ç§’ï¼ˆä¸éœ€è¦ç­‰ 3 ç§’ï¼‰

### åœºæ™¯ 2: HTTP å¤±è´¥å›é€€ UDP

**æ¨¡æ‹Ÿ**: é˜»æ­¢ HTTP ç«¯å£ï¼Œæµ‹è¯• UDP fallback

**æ­¥éª¤**:
1. ä¿®æ”¹é˜²ç«å¢™ä¸´æ—¶é˜»æ­¢ TCP 53317
2. å¯åŠ¨ä¸¤ä¸ªå®ä¾‹

**é¢„æœŸç»“æœ**:
```
[UDP RESPOND] DeviceName (192.168.1.100) - HTTP failed
```

**éªŒè¯ç‚¹**:
- âœ… çœ‹åˆ° `HTTP failed` è¡¨ç¤º fallback ç”Ÿæ•ˆ
- âœ… ä»ç„¶èƒ½å‘ç°è®¾å¤‡ï¼ˆé€šè¿‡ UDPï¼‰

## è§‚å¯Ÿå¯åŠ¨å¹¿æ’­åºåˆ—

**æ–¹æ³•**: ä½¿ç”¨ Wireshark æˆ– tcpdump æŠ“åŒ…

```bash
# Linux/WSL
sudo tcpdump -i any port 53317 -A

# æˆ–ä½¿ç”¨ tshark
sudo tshark -i any -f "port 53317"
```

**é¢„æœŸ**: å¯åŠ¨å 2.6 ç§’å†…çœ‹åˆ° 3 ä¸ª UDP åŒ…ï¼š
- t=0.1s: ç¬¬ 1 æ¬¡å¹¿æ’­
- t=0.6s: ç¬¬ 2 æ¬¡å¹¿æ’­ï¼ˆ0.1 + 0.5ï¼‰
- t=2.6s: ç¬¬ 3 æ¬¡å¹¿æ’­ï¼ˆ0.6 + 2.0ï¼‰

## éªŒè¯åŒå‘ç¡®è®¤

**æ£€æŸ¥ç‚¹**:

1. **è®¾å¤‡ A å‘é€å…¬å‘Š**
   ```json
   {
     "announcement": true,
     "fingerprint": "abc123...",
     ...
   }
   ```

2. **è®¾å¤‡ B æ”¶åˆ°åå“åº”**
   - ä¼˜å…ˆå‘é€ HTTP POST /api/localsend/v2/register
   - æˆ–å‘é€ UDP å“åº”ï¼ˆannouncement=falseï¼‰

3. **è®¾å¤‡ A æ”¶åˆ°å“åº”**
   - æ³¨å†Œè®¾å¤‡ B
   - åŒå‘å‘ç°å®Œæˆ âœ“

## æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡           | æ—§å®ç°  | æ–°å®ç°  | æ”¹è¿›   |
|----------------|---------|---------|--------|
| é¦–æ¬¡å‘ç°å»¶è¿Ÿ   | 0-3ç§’   | 0-2ç§’   | âœ… æ›´å¿« |
| ä¸¢åŒ…å®¹é”™       | ä½      | é«˜      | âœ… 3æ¬¡  |
| å¯é æ€§         | UDP only| TCPä¼˜å…ˆ | âœ… æ›´é«˜ |
| åŒå‘ç¡®è®¤       | âŒ      | âœ…      | âœ… æ–°å¢ |

## æ•…éšœæ’æŸ¥

### çœ‹ä¸åˆ° [HTTP RESPOND] æ—¥å¿—

**å¯èƒ½åŸå› **:
1. HTTP æœåŠ¡å™¨ç«¯å£å†²çªï¼ˆæ£€æŸ¥ç«¯å£æ˜¯å¦é€’å¢åˆ° 53318+ï¼‰
2. é˜²ç«å¢™é˜»æ­¢ TCP è¿æ¥
3. ä¸¤ä¸ªå®ä¾‹åœ¨ä¸åŒå­ç½‘

**è§£å†³**:
- æ£€æŸ¥ä¸¤ä¸ªå®ä¾‹çš„ç«¯å£å·
- ä¸´æ—¶å…³é—­é˜²ç«å¢™æµ‹è¯•
- ç¡®ä¿åœ¨åŒä¸€ç½‘æ®µ

### è®¾å¤‡æ— æ³•äº’ç›¸å‘ç°

**æ£€æŸ¥**:
1. UDP å¤šæ’­æ˜¯å¦å·¥ä½œï¼š`netstat -g` (Linux)
2. é˜²ç«å¢™æ˜¯å¦å…è®¸ UDP 53317
3. è·¯ç”±å™¨æ˜¯å¦å¯ç”¨ AP éš”ç¦»

## ä¸‹ä¸€æ­¥ä¼˜åŒ–

å‰©ä½™æœªå®ç°çš„åŠŸèƒ½ï¼š
- ğŸŸ¡ HTTP å­ç½‘æ‰«æï¼ˆAP éš”ç¦»ç¯å¢ƒå¤‡ç”¨ï¼‰
- ğŸŸ¡ å–æ¶ˆå®šæœŸå¹¿æ’­ï¼ˆä»…å¯åŠ¨æ—¶ï¼Œä¾èµ–åŒå‘ç¡®è®¤ï¼‰
